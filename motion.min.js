/**
 * Copyright (C) 2011 by Ollie Parsley
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */
(function(){window.isMotionSupported=function(){return window.DeviceMotionEvent!==undefined};window.isOrientationSupported=function(){return window.DeviceOrientationEvent!==undefined||window.OrientationEvent!==undefined};if(window.isMotionSupported()){var a={events:{},stopping:false,starting:false,shaking:false,sensitivity:5,currentCoords:null,init:function(){this.events["start"]=document.createEvent("Event");this.events["start"].initEvent("shakestart",true,true);this.events["end"]=document.createEvent("Event");this.events["end"].initEvent("shakeend",true,true);this.listen()},start:function(){this.shaking=true;window.dispatchEvent(this.events["start"])},stop:function(){this.shaking=false;this.lastStop=(new Date).getTime();window.dispatchEvent(this.events["end"])},listen:function(){var a=this;window.addEventListener("devicemotion",function(b){var c=0;var d=b.accelerationIncludingGravity.x;var e=b.accelerationIncludingGravity.y;var f=b.accelerationIncludingGravity.z;if(a.coords!=null){c=Math.abs(a.coords.x-d+a.coords.y-e+a.coords.z-f)}else{a.coords={}}a.coords.x=d;a.coords.y=e;a.coords.z=f;if(c>=a.sensitivity){if(!a.shaking){if(a.starting){a.start();a.starting=false}else{a.starting=true}}}else{if(a.shaking){if(a.stopping){a.stop();a.stopping=false}else{a.stopping=true}}}},false)}};a.init()}if(window.isOrientationSupported()){var b={events:{},faceupActive:false,facedownActive:false,rotateLeftActive:false,rotateRightActive:false,sensitivity:20,init:function(){this.events["faceupstart"]=document.createEvent("Event");this.events["faceupstart"].initEvent("faceupstart",true,true);this.events["faceupend"]=document.createEvent("Event");this.events["faceupend"].initEvent("faceupend",true,true);this.events["facedownstart"]=document.createEvent("Event");this.events["facedownstart"].initEvent("facedownstart",true,true);this.events["facedownend"]=document.createEvent("Event");this.events["facedownend"].initEvent("facedownend",true,true);this.listen()},faceup:function(a){this.faceupActive=a;if(a){window.dispatchEvent(this.events["faceupstart"])}else{window.dispatchEvent(this.events["faceupend"])}},facedown:function(a){this.facedownActive=a;if(a){window.dispatchEvent(this.events["facedownstart"])}else{window.dispatchEvent(this.events["facedownend"])}},listen:function(){var a=this;window.addEventListener("deviceorientation",function(b){a.process(parseInt(b.alpha,10),parseInt(b.beta,10),parseInt(b.gamma,10))},false);window.addEventListener("MozOrientation",function(b){a.process(null,parseInt(-(b.x*(180/Math.PI))),parseInt(-(b.y*(180/Math.PI))))},false)},process:function(a,b,c){var d=this.sensitivity;if(!this.faceupActive&&b<0+d&&b>0-d&&c<0+d&&c>0-d){this.faceup(true)}else if(this.faceupActive&&(b>0+d||b<0-d||c>0+d||c<0-d)){this.faceup(false)}if(!this.facedownActive&&b<0+d&&b>0-d&&c<180+d&&c>180-d){this.facedown(true)}else if(this.facedownActive&&(b>0+d||b<0-d||c>180+d||c<180-d)){this.facedown(false)}}};b.init()}})()